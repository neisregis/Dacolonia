<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes do Supervisor ou Representante</title>
</head>
<body>
    <h1>Lista de Clientes</h1>
    
    <ul id="listaClientes"></ul>

    <script>
        // Função para obter parâmetros da URL
        function getParameterByName(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name);
        }

        // Obtém o código do representante e supervisor da URL
        const repCode = getParameterByName('repCode');
        const supCode = getParameterByName('supCode');

        // Caminho para o arquivo JSON
        const url = 'https://neisregis.github.io/Dacolonia/superv_rep_grupo_cli.json';

        // Função para exibir clientes
        function exibirClientes(clientesPorGrupo) {
            const lista = document.getElementById('listaClientes');
            lista.innerHTML = ''; // Limpa a lista anterior

            Object.keys(clientesPorGrupo).forEach(grupo => {
                const grupoItem = document.createElement('li');
                grupoItem.textContent = `Grupo de Cliente: ${grupo}`;
                lista.appendChild(grupoItem);

                const subLista = document.createElement('ul');
                clientesPorGrupo[grupo].forEach(cliente => {
                    const clienteItem = document.createElement('li');
                    clienteItem.textContent = `Código do Cliente: ${cliente.codigo_cliente}, Descrição: ${cliente.desc_cliente}`;
                    subLista.appendChild(clienteItem);
                });

                lista.appendChild(subLista);
            });
        }

        // Faz a requisição e filtra os clientes pelo código do representante ou supervisor
        fetch(url)
            .then(response => response.json())
            .then(data => {
                console.log(data); // Verifica o conteúdo do JSON no console

                if (supCode) {
                    // Filtragem pelo código do supervisor
                    if (data[supCode]) {
                        const representantes = data[supCode]['representantes'];
                        let clientesPorGrupo = {};

                        Object.values(representantes).forEach(grupos => {
                            Object.keys(grupos).forEach(grupo => {
                                if (!clientesPorGrupo[grupo]) {
                                    clientesPorGrupo[grupo] = [];
                                }
                                clientesPorGrupo[grupo] = clientesPorGrupo[grupo].concat(grupos[grupo]);
                            });
                        });

                        // Exibe os clientes na página
                        exibirClientes(clientesPorGrupo);
                    } else {
                        document.getElementById('listaClientes').innerHTML = 'Nenhum cliente encontrado para este supervisor.';
                    }
                } else if (repCode) {
                    // Filtragem pelo código do representante
                    let encontrado = false;
                    Object.keys(data).forEach(sup => {
                        const representantes = data[sup]['representantes'];
                        if (representantes[repCode]) {
                            encontrado = true;
                            const clientesPorGrupo = representantes[repCode];
                            exibirClientes(clientesPorGrupo);
                        }
                    });

                    if (!encontrado) {
                        document.getElementById('listaClientes').innerHTML = 'Nenhum cliente encontrado para este representante.';
                    }
                } else {
                    document.getElementById('listaClientes').innerHTML = 'Nenhum código de supervisor ou representante fornecido.';
                }
            })
            .catch(error => console.error('Erro ao buscar os dados:', error));
    </script>
</body>
</html>
