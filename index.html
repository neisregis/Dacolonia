<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clientes do Supervisor ou Representante</title>
    <link rel="stylesheet" href="styles.css"> <!-- Link para o arquivo CSS externo -->
</head>
<body>

<header>
    <h1>Lista de Clientes</h1>
    <img id="logo" src="Dacolonia.png" alt="Logo da Empresa">
</header>

<ul id="listaClientes"></ul>

<script>
    // Função para obter parâmetros da URL
    function getParameterByName(name) {
        const url = new URL(window.location.href);
        return url.searchParams.get(name);
    }

    // Obtém o código do representante e supervisor da URL
    const repCode = getParameterByName('repCode');
    const supCode = getParameterByName('supCode');

    // Caminho para o arquivo JSON
    const url = 'https://neisregis.github.io/Dacolonia/superv_rep_grupo_cli.json';

    // Função para exibir clientes com funcionalidade de abrir/fechar grupos
    function exibirClientes(clientesPorGrupo) {
        const lista = document.getElementById('listaClientes');
        lista.innerHTML = ''; // Limpa a lista anterior

        Object.keys(clientesPorGrupo).forEach(grupo => {
            // Cria o item de grupo
            const grupoItem = document.createElement('li');
            grupoItem.classList.add('grupo');
            
            const toggleButton = document.createElement('button');
            toggleButton.classList.add('toggle-button');
            toggleButton.textContent = '+';
            
            const grupoTexto = document.createElement('span');
            grupoTexto.textContent = `Grupo de Cliente: ${grupo}`;

            grupoItem.appendChild(toggleButton);
            grupoItem.appendChild(grupoTexto);
            lista.appendChild(grupoItem);

            // Cria a lista de clientes escondida inicialmente
            const subLista = document.createElement('ul');
            subLista.classList.add('clientes');
            
            clientesPorGrupo[grupo].forEach(cliente => {
                const clienteItem = document.createElement('li');
                clienteItem.textContent = `Código do Cliente: ${cliente.codigo_cliente}, Descrição: ${cliente.desc_cliente}`;
                subLista.appendChild(clienteItem);
            });

            lista.appendChild(subLista);

            // Evento de clique para abrir/fechar a lista de clientes
            toggleButton.addEventListener('click', function() {
                if (subLista.style.display === 'none' || subLista.style.display === '') {
                    subLista.style.display = 'block';
                    toggleButton.textContent = '-';
                } else {
                    subLista.style.display = 'none';
                    toggleButton.textContent = '+';
                }
            });
        });
    }

    // Faz a requisição e filtra os clientes pelo código do representante ou supervisor
    fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log(data); // Verifica o conteúdo do JSON no console

            if (supCode) {
                // Filtragem pelo código do supervisor
                if (data[supCode]) {
                    const representantes = data[supCode]['representantes'];
                    let clientesPorGrupo = {};

                    Object.values(representantes).forEach(grupos => {
                        Object.keys(grupos).forEach(grupo => {
                            if (!clientesPorGrupo[grupo]) {
                                clientesPorGrupo[grupo] = [];
                            }
                            clientesPorGrupo[grupo] = clientesPorGrupo[grupo].concat(grupos[grupo]);
                        });
                    });

                    // Exibe os clientes na página
                    exibirClientes(clientesPorGrupo);
                } else {
                    document.getElementById('listaClientes').innerHTML = 'Nenhum cliente encontrado para este supervisor.';
                }
            } else if (repCode) {
                // Filtragem pelo código do representante
                let encontrado = false;
                Object.keys(data).forEach(sup => {
                    const representantes = data[sup]['representantes'];
                    if (representantes[repCode]) {
                        encontrado = true;
                        const clientesPorGrupo = representantes[repCode];
                        exibirClientes(clientesPorGrupo);
                    }
                });

                if (!encontrado) {
                    document.getElementById('listaClientes').innerHTML = 'Nenhum cliente encontrado para este representante.';
                }
            } else {
                document.getElementById('listaClientes').innerHTML = 'Nenhum código de supervisor ou representante fornecido.';
            }
        })
        .catch(error => console.error('Erro ao buscar os dados:', error));
</script>

</body>
</html>
